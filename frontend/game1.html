<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Voice Boom</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Scheherazade+New:wght@400;700&family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Naskh Arabic', sans-serif;
            color: #E0E0E0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            overflow-x: hidden;
            position: relative;
            z-index: 0;

            background-image: url('images/background_image.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-blend-mode: overlay;
            background-color: rgba(0, 0, 0, 0.6);
        }

        .header-container {
            display: flex;
            justify-content: space-between; /* Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ± */
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 10px;
            position: relative; /* Ù„ØªÙ…ÙƒÙŠÙ† ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø¨Ø´ÙƒÙ„ Ù…Ø·Ù„Ù‚ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø± */
        }

        .top-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-grow: 1; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù‡Ø§ Ø¨Ø£Ø®Ø° Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ§Ø­Ø© ÙˆØ¯ÙØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®Ø±Ù‰ */
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„ØªÙˆØ³ÙŠØ·Ù‡Ù…Ø§ */
        .centered-header-content {
            position: absolute; /* ÙˆØ¶Ø¹ Ù…Ø·Ù„Ù‚ Ù„ØªÙˆØ³ÙŠØ·Ù‡Ø§ Ø¨ØºØ¶ Ø§Ù„Ù†Ø¸Ø± Ø¹Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®Ø±Ù‰ */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1; /* ØªØ£ÙƒØ¯ Ø£Ù†Ù‡Ø§ ÙÙˆÙ‚ Ø¹Ù†Ø§ØµØ± Ø£Ø®Ø±Ù‰ Ø¥Ø°Ø§ ØªØ¯Ø§Ø®Ù„Øª */
        }

        .logo {
            width: 70px; /* Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ø´Ø¹Ø§Ø± */
            height: 70px; /* Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ø´Ø¹Ø§Ø± */
            border-radius: 50%;
            border: 2px solid #3498db;
            object-fit: cover;
        }

        .game-title {
            font-family: 'Amiri', serif;
            font-size: 3em; /* Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù„Ø§Ø³Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© */
            color: #3498db;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
            margin: 0;
        }
        
        @keyframes pulse {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(1.05); opacity: 0.8; }
        }


        .player-info {
            font-size: 1.1em;
            color: #E0E0E0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-info i {
            color: #27ae60;
        }

        .top-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .settings-button-group {
            display: flex;
            gap: 10px;
        }

        .action-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease, transform 0.1s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .action-button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .action-button:disabled {
            background-color: #7f8c8d;
            cursor: not-allowed;
        }

        /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„ØªÙƒÙˆÙ† ÙÙŠ ØµÙ ÙˆØ§Ø­Ø¯ */
        .game-container .action-buttons-group {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
            flex-wrap: wrap; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù†Ù‡Ø§ */
        }

        #singleShotButton { 
            background-color: #28a745; /* Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± */
        }
        #singleShotButton:hover { 
            background-color: #218838;
        }

        #tripleShotButton {
            background-color: #e67e22; /* Ù„ÙˆÙ† Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
        }
        #tripleShotButton:hover {
            background-color: #d35400;
        }

        #hammerShotButton { 
            background-color: #6C757D; /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ */
        }
        #hammerShotButton:hover {
            background-color: #5A6268;
        }

        .game-container {
            background-color: rgba(44, 62, 80, 0.9);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
            text-align: center;
            width: 100%;
            max-width: 1200px;
            margin-top: 20px;
            position: relative; /* Ù…Ù‡Ù… Ù„ÙˆØ¶Ø¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¤Ø´Ø± Ø¨Ø¯Ø§Ø®Ù„Ù‡ */
        }

        .messages-area {
            min-height: 50px; 
            margin-bottom: 20px;
            padding: 10px 15px; 
            border-radius: 8px;
            background-color: rgba(0, 0, 0, 0.6); 
            font-size: 1.8em; 
            font-weight: bold;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.8); 
            
            display: flex;
            align-items: center;
            justify-content: center;
            
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.7);
            transition: box-shadow 0.3s ease-in-out; 
            color: #e0e0e0; 
        }
        
        .messages-area.win-glow {
            box-shadow: 0 0 25px 10px rgba(40, 167, 69, 0.9), 
                        0 0 40px 15px rgba(40, 167, 69, 0.7); 
            color: #d4edda; 
        }

        .messages-area.lose-glow {
            box-shadow: 0 0 25px 10px rgba(220, 53, 69, 0.9), 
                        0 0 40px 15px rgba(220, 53, 69, 0.7); 
            color: #f8d7da; 
        }

        .score-board-in-main {
            background-color: rgba(52, 152, 219, 0.8);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px; 
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            font-size: 1.1em;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
        }

        .score-board-in-main .score-item {
            font-weight: bold;
            color: #ECF0F1;
        }

        .score-board-in-main .score-item span {
            color: #2C3E50;
            font-size: 0.9em; 
        }

        .boxes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
            position: relative; /* Ù…Ù‡Ù… Ù„ÙˆØ¶Ø¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¤Ø´Ø± Ø¨Ø¯Ø§Ø®Ù„Ù‡ Ùˆ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆØ¶Ø¹Ù‡Ø§ */
        }

        .box {
            background-color: #2A9D8F;
            height: 150px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s ease, box-shadow 0.3s ease, border 0.3s ease, background-color 0.3s ease, opacity 0.5s ease; 
            border: 2px solid #333333;
            color: #FFFFFF;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
            position: relative;
            overflow: hidden;
            
            animation: floatAndGlow 4s infinite ease-in-out;
            box-shadow: 0 0 15px 5px var(--glow-color, rgba(51, 51, 51, 0.5)); 
        }

        .box .box-image {
            max-width: 80%;
            max-height: 80%;
            object-fit: contain;
            margin-bottom: 5px;
        }
        
        @keyframes floatAndGlow {
            0% { 
                transform: translateY(0px) scale(1); 
                box-shadow: 0 0 15px 5px var(--glow-color, rgba(51, 51, 51, 0.5)); 
            }
            25% { 
                transform: translateY(-8px) scale(1.03); 
                box-shadow: 0 0 20px 8px var(--glow-color, rgba(68, 68, 68, 0.7)); 
            }
            50% { 
                transform: translateY(0px) scale(1); 
                box-shadow: 0 0 15px 5px var(--glow-color, rgba(51, 51, 51, 0.5)); 
            }
            75% { 
                transform: translateY(8px) scale(1.03); 
                box-shadow: 0 0 20px 8px var(--glow-color, rgba(68, 68, 68, 0.7)); 
            }
            100% { 
                transform: translateY(0px) scale(1); 
                box-shadow: 0 0 15px 5px var(--glow-color, rgba(51, 51, 51, 0.5)); 
            }
        }
        
        /* âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…Ø· Ù„ÙŠÙƒÙˆÙ† Ø§Ù„ØªÙˆÙ‡Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¶Ø±Ø¨Ø§Øª */
        .box.single-shot-final-glow {
            animation: finalSingleShotPulse 1s infinite alternate; 
            box-shadow: 0 0 30px 12px rgba(40, 167, 69, 0.9), 
                        0 0 50px 20px rgba(40, 167, 69, 0.7) !important; 
            border-color: #28a745 !important;
            transform: scale(1.07);
        }

        @keyframes finalSingleShotPulse {
            from { box-shadow: 0 0 30px 12px rgba(40, 167, 69, 0.9); }
            to { box-shadow: 0 0 50px 20px rgba(40, 167, 69, 0.7); }
        }

        .box.sequential-glow {
            animation: sequentialPulse 0.8s infinite alternate; 
            box-shadow: 0 0 20px 8px rgba(255, 255, 0, 0.8), 
                        0 0 30px 12px rgba(255, 255, 0, 0.6) !important;
            border-color: #FFD700 !important; 
            transform: scale(1.02);
        }

        @keyframes sequentialPulse {
            from { box-shadow: 0 0 20px 8px rgba(255, 255, 0, 0.8); }
            to { box-shadow: 0 0 30px 12px rgba(255, 255, 0, 0.6); }
        }


        .box:hover:not(.opened) {
            transform: translateY(-12px) scale(1.07);
            animation: none;
            box-shadow: 0 0 30px 12px var(--glow-color, rgba(255, 255, 255, 0.9)) !important; 
        }

        .box.opened {
            cursor: default;
            animation: none !important;
            box-shadow: 0 0 20px 8px rgba(0, 0, 0, 0.8) !important;
            font-size: 3em;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .box.opened .box-image,
        .box.opened .box-text {
            display: none;
        }

        .box.opened.positive-score-10 {
            background-color: #3498DB;
            border: 2px solid #2980B9;
            color: #ECF0F1;
            font-weight: bold;
        }

        .box.opened.positive-score-5 {
            background-color: #9B59B6;
            border: 2px solid #8E44AD;
            color: #ECF0F1;
            font-weight: bold;
        }

        .box.opened.positive-score-1 {
            background-color: #DC143C;
            border: 2px solid #A52A2A;
            color: #ECF0F1;
            font-weight: bold;
        }

        .box.opened.negative-score-5 {
            background-color: #F39C12;
            border: 2px solid #E67E22;
            color: #2C3E50;
            font-weight: bold;
        }

        .box.opened.negative-score-10 {
            background-color: #E74C3C;
            border: 2px solid #C0392B;
            color: #ECF0F1;
            font-weight: bold;
        }

        .logout-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .logout-button:hover {
            background-color: #c0392b;
        }

        .volume-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .volume-controls button {
            background-color: #7f8c8d;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }

        .volume-controls button:hover {
            background-color: #95a5a6;
        }

        #volumeSlider {
            width: 100px;
            -webkit-appearance: none;
            height: 8px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
            border-radius: 4px;
        }

        #volumeSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
        }

        #volumeSlider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
        }

        /* Ø£Ù†Ù…Ø§Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        .seeker-image {
            position: absolute !important; /* ÙØ±Ø¶ Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·Ù„Ù‚ */
            display: none; /* Ù…Ø®ÙÙŠ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
            width: 80px; /* ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… Ù‡Ù†Ø§ */
            height: 80px; /* ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… Ù‡Ù†Ø§ */
            transition: left 1.2s ease-out, top 1.2s ease-out; /* Ø­Ø±ÙƒØ© Ø³Ù„Ø³Ø© - ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¯Ø© Ù‡Ù†Ø§ */
            z-index: 10; /* Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ±Ù‡Ø§ ÙÙˆÙ‚ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ */
            transform: translate(-50%, -50%); /* Ù„ØªÙˆØ³ÙŠØ· Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª */
            border-radius: 50%; /* Ù„Ø¬Ø¹Ù„Ù‡Ø§ Ø¯Ø§Ø¦Ø±ÙŠØ© */
            box-shadow: 0 0 25px 10px rgba(255, 255, 0, 0.9); /* ØªÙˆÙ‡Ø¬ Ø£ÙˆÙ„ÙŠ Ø£Ù‚ÙˆÙ‰ */
            /* New: Temporary styles for debugging image loading */
            background-color: rgba(255, 0, 0, 0.7); /* Red background if image fails (for NO IMAGE fallback) */
            display: flex; /* To center "NO IMAGE" text */
            align-items: center;
            justify-content: center;
            font-size: 0.9em; /* ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù‡Ù†Ø§ */
            color: white;
            text-align: center;
            overflow: hidden; /* Prevent text overflow if too long */
            opacity: 1; /* ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙØ§ÙÙŠØ© Ù‡Ù†Ø§ Ù„ØªØµØ¨Ø­ 100% */
        }

        /* Ø­Ø±ÙƒØ© Ø§Ù„ØªÙˆÙ‡Ø¬ Ù„Ù„ØµÙˆØ±Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ */
        @keyframes finalSeekerPulse {
            from { transform: translate(-50%, -50%) scale(1); opacity: 1; box-shadow: 0 0 25px 10px rgba(255, 255, 0, 0.9); } /* ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙØ§ÙÙŠØ© ÙˆØ§Ù„ØªÙˆÙ‡Ø¬ Ù‡Ù†Ø§ */
            to { transform: translate(-50%, -50%) scale(1.2); opacity: 1; box-shadow: 0 0 40px 15px rgba(255, 255, 0, 1); } /* ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙØ§ÙÙŠØ© ÙˆØ§Ù„ØªÙˆÙ‡Ø¬ Ù‡Ù†Ø§ */
        }
    </style>
</head>
<body>
    <div class="header-container">
        <div class="top-left">
            </div>
        <div class="centered-header-content"> <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù„Ø¹Ø¨Ø©" class="logo">
            <h1 class="game-title">Voice Boom</h1>
        </div>
        <div class="top-right">
            <div class="player-info">
                <i class="fas fa-user-circle"></i>
                <span id="usernameDisplay"></span> <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ù‡Ø°Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            <div class="settings-button-group">
                <button id="logoutButton" class="logout-button">
                    <i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬
                </button>
            </div>
        </div>
    </div>

    <div class="game-container">
        <div class="messages-area" id="messagesArea">
            </div>
        
        <div class="action-buttons-group">
            <button id="tripleShotButton" class="action-button">
                <i class="fas fa-bullseye"></i> Ø¶Ø±Ø¨Ø© Ø«Ù„Ø§Ø«ÙŠØ© (5 Ù‚Ø·Ø¹ Ù†Ù‚Ø¯ÙŠØ©)
            </button>
            <button id="singleShotButton" class="action-button"> 
                <i class="fas fa-crosshairs"></i> Ø¶Ø±Ø¨Ø© ÙØ±Ø¯ÙŠØ© (2 Ù‚Ø·Ø¹Ø© Ù†Ù‚Ø¯ÙŠØ©)
            </button>
            <button id="hammerShotButton" class="action-button">
                <i class="fas fa-hammer"></i> Ø¶Ø±Ø¨Ø© Ø§Ù„Ù…Ø·Ø±Ù‚Ø© (20 Ù‚Ø·Ø¹Ø© Ù†Ù‚Ø¯ÙŠØ©)
            </button>
        </div>
        
        <div class="score-board-in-main" id="scoreBoardMain">
            <div class="score-item">Ø§Ù„Ø¬ÙˆÙ„Ø©: <span id="roundNumber">0</span></div>
            <div class="score-item">Ù‚Ø·Ø¹ Ù†Ù‚Ø¯ÙŠØ© Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span id="currentRoundPoints">0</span></div>
            <div class="score-item">Ù‚Ø·Ø¹Ùƒ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø§Ù„ÙƒÙ„ÙŠØ©: <span id="personalScore">0</span></div>
            <div class="score-item">Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©: <span id="highScore">0</span></div>
            <!-- âœ… Ø¥Ø¶Ø§ÙØ© Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¶Ø±Ø¨Ø§Øª Ù‡Ù†Ø§ -->
            <div class="score-item">Ø¶Ø±Ø¨Ø§Øª ÙØ±Ø¯ÙŠØ©: <span id="singleShotsUsed">0</span></div>
            <div class="score-item">Ø¶Ø±Ø¨Ø§Øª Ø«Ù„Ø§Ø«ÙŠØ©: <span id="tripleShotsUsed">0</span></div>
            <div class="score-item">Ø¶Ø±Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ø±Ù‚Ø©: <span id="hammerShotsUsed">0</span></div>
        </div>

        <div id="boxesContainer" class="boxes-grid">
            <!-- Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ù‡Ù†Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
        </div>
        <!-- Moved seekerImage outside boxesContainer, but still within game-container -->
        <img id="seekerImage" src="images/hero.png" alt="Ø´Ø®ØµÙŠØ© Ø§Ù„Ø¨Ø·Ù„" class="seeker-image" onerror="this.onerror=null; this.src='https://placehold.co/50x50/FF0000/FFFFFF?text=ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© hero.png ÙÙŠ images'; console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ hero.png. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„Ù ÙÙŠ images.');">

        <div class="volume-controls">
            <button id="decreaseVolumeBtn"><i class="fas fa-volume-down"></i></button>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5">
            <button id="increaseVolumeBtn"><i class="fas fa-volume-up"></i></button>
            <button id="muteToggleBtn"><i class="fas fa-volume-mute"></i></button>
        </div>

    </div>

    <audio id="strikeMusic" src="sounds/strike_music.mp3"></audio> 
    <audio id="winSound" src="sounds/win.mp3"></audio>
    <audio id="loseSound" src="sounds/lose.mp3"></audio>

    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let username = null; // Ø³ÙŠØªÙ… Ø¬Ù„Ø¨Ù‡ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
        let currentRoundPoints = 0;
        let boxes = [];
        let personalScore = 50; 
        let highScore = 0;
        let roundNumber = 0;
        let numBoxes = 10;
        
        let num10PointsBoxes = 1;
        let num5PointsBoxes = 2;
        let num1PointsBoxes = 3;
        let numNegative5PointsBoxes = 1;
        let numNegative10PointsBoxes = 0;

        let isAdmin = true; 
        let sequentialGlowInterval = null; 
        let sequentialGlowIndex = 0; 
        // âœ… Ù…ØªØºÙŠØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØªØ¨Ø¹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¶Ø±Ø¨Ø§Øª
        let singleShotsUsed = 0;
        let tripleShotsUsed = 0;
        let hammerShotsUsed = 0;


        // ØªÙƒØ§Ù„ÙŠÙ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø²Ø±
        const SINGLE_SHOT_COST = 2; 
        const TRIPLE_SHOT_COST = 5;
        const HAMMER_SHOT_COST = 20; 
        const HAMMER_SHOT_BOXES = 15; 

        const glowColors = [
            'rgba(52, 152, 219, 0.8)',
            'rgba(155, 89, 182, 0.8)',
            'rgba(220, 20, 60, 0.8)',
            'rgba(243, 156, 18, 0.8)',
            'rgba(231, 76, 60, 0.8)',
            'rgba(46, 204, 113, 0.8)',
            'rgba(241, 196, 15, 0.8)',
            'rgba(189, 195, 199, 0.8)'
        ];

        // Ø¹Ù†Ø§ØµØ± HTML
        const usernameDisplay = document.getElementById('usernameDisplay');
        const messagesArea = document.getElementById('messagesArea');
        const singleShotButton = document.getElementById('singleShotButton'); 
        const tripleShotButton = document.getElementById('tripleShotButton'); 
        const hammerShotButton = document.getElementById('hammerShotButton'); 
        const boxesContainer = document.getElementById('boxesContainer');
        const scoreBoardMain = document.getElementById('scoreBoardMain'); 
        const currentRoundPointsDisplay = document = document.getElementById('currentRoundPoints');
        const personalScoreDisplay = document.getElementById('personalScore');
        const highScoreDisplay = document.getElementById('highScore');
        const roundNumberDisplay = document.getElementById('roundNumber');

        const strikeMusic = document.getElementById('strikeMusic'); 
        const winSound = document.getElementById('winSound');
        const loseSound = document.getElementById('loseSound');
        const logoutButton = document.getElementById('logoutButton');
        const volumeSlider = document.getElementById('volumeSlider');
        const increaseVolumeBtn = document.getElementById('increaseVolumeBtn');
        const decreaseVolumeBtn = document.getElementById('decreaseVolumeBtn');
        const muteToggleBtn = document.getElementById('muteToggleBtn');
        // âœ… Ø¹Ù†Ø§ØµØ± HTML Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¶Ø±Ø¨Ø§Øª
        const singleShotsUsedDisplay = document.getElementById('singleShotsUsed');
        const tripleShotsUsedDisplay = document.getElementById('tripleShotsUsed');
        const hammerShotsUsedDisplay = document.getElementById('hammerShotsUsed');

        // âœ… Ø¹Ù†ØµØ± ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø§Ù„Ù…Ø¤Ø´Ø±)
        const seekerImage = document.getElementById('seekerImage');
        
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØµÙˆØª
        function setVolume(volume) {
            strikeMusic.volume = volume; 
            winSound.volume = volume;
            loseSound.volume = volume;
        }

        function updateVolumeFromSlider() {
            setVolume(volumeSlider.value);
        }

        function increaseVolume() {
            volumeSlider.value = Math.min(parseFloat(volumeSlider.value) + 0.1, 1);
            updateVolumeFromSlider();
            muteToggleBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
        }

        function decreaseVolume() {
            volumeSlider.value = Math.max(parseFloat(volumeSlider.value) - 0.1, 0);
            updateVolumeFromSlider();
            if (volumeSlider.value == 0) {
                muteToggleBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
            }
        }

        function playSound(audioElement, errorMsg) {
            if (audioElement.readyState >= 3) { 
                audioElement.play().catch(e => console.error(errorMsg, e));
            } else {
                console.warn(`Cannot play ${audioElement.id}: Audio element not ready. Current state: ${audioElement.readyState}`);
            }
        }

        function stopAndResetSound(audioElement) { 
            audioElement.pause();
            audioElement.currentTime = 0;
            audioElement.loop = false; // âœ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±
        }

        function toggleMute() {
            if (strikeMusic.muted) { 
                strikeMusic.muted = false; 
                winSound.muted = false;
                loseSound.muted = false;
                muteToggleBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                if (volumeSlider.value == 0) {
                    volumeSlider.value = 0.5;
                }
                setVolume(volumeSlider.value);
            } else {
                strikeMusic.muted = true; 
                winSound.muted = true;
                loseSound.muted = true;
                muteToggleBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
            }
        }

        // ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Ù…Ø¹Ø¯Ù„Ø© Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬)
        function showMessage(msg, isError = false, isWin = false) {
            messagesArea.textContent = msg;
            
            messagesArea.classList.remove('win-glow', 'lose-glow');

            if (isError) {
                messagesArea.classList.add('lose-glow');
                messagesArea.textContent += ' ğŸ˜'; // Add sad emoji for errors/losses
            } else if (isWin) {
                messagesArea.classList.add('win-glow');
                messagesArea.textContent += ' ğŸ‰'; // Add party popper emoji for wins
            } else {
                messagesArea.style.boxShadow = '0 0 15px rgba(52, 152, 219, 0.7)'; 
                messagesArea.style.color = '#e0e0e0'; 
            }
        }

        // ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function updateScoreBoard() {
            currentRoundPointsDisplay.textContent = currentRoundPoints; 
            personalScoreDisplay.textContent = personalScore;
            highScoreDisplay.textContent = highScore;
            roundNumberDisplay.textContent = roundNumber;
            // âœ… ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¶Ø±Ø¨Ø§Øª
            singleShotsUsedDisplay.textContent = singleShotsUsed;
            tripleShotsUsedDisplay.textContent = tripleShotsUsed;
            hammerShotsUsedDisplay.textContent = hammerShotsUsed;
            updateActionButtonsState(); 
        }

        // ÙˆØ¸ÙŠÙØªØ§Ù† Ù„ØªØ¹Ø·ÙŠÙ„ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        function disableAllActionButtons() {
            singleShotButton.disabled = true;
            tripleShotButton.disabled = true;
            hammerShotButton.disabled = true;
        }

        function enableAllActionButtons() {
            singleShotButton.disabled = personalScore < SINGLE_SHOT_COST;
            singleShotButton.title = singleShotButton.disabled ? `ØªØ­ØªØ§Ø¬ ${SINGLE_SHOT_COST} Ù‚Ø·Ø¹Ø© Ù†Ù‚Ø¯ÙŠØ© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… "Ø¶Ø±Ø¨Ø© ÙØ±Ø¯ÙŠØ©"` : '';

            tripleShotButton.disabled = personalScore < TRIPLE_SHOT_COST;
            tripleShotButton.title = tripleShotButton.disabled ? `ØªØ­ØªØ§Ø¬ ${TRIPLE_SHOT_COST} Ù‚Ø·Ø¹Ø© Ù†Ù‚Ø¯ÙŠØ© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… "Ø¶Ø±Ø¨Ø© Ø«Ù„Ø§Ø«ÙŠØ©"` : '';

            hammerShotButton.disabled = personalScore < HAMMER_SHOT_COST;
            hammerShotButton.title = hammerShotButton.disabled ? `ØªØ­ØªØ§Ø¬ ${HAMMER_SHOT_COST} Ù‚Ø·Ø¹Ø© Ù†Ù‚Ø¯ÙŠØ© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… "Ø¶Ø±Ø¨Ø© Ø§Ù„Ù…Ø·Ø±Ù‚Ø©"` : '';
        }


        // ÙˆØ¸ÙŠÙØ© Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± "ØªÙ„Ù‚Ø§Ø¦ÙŠ" Ùˆ "Ø¶Ø±Ø¨Ø© Ø«Ù„Ø§Ø«ÙŠØ©" Ùˆ "Ø¶Ø±Ø¨Ø© Ø§Ù„Ù…Ø·Ø±Ù‚Ø©"
        function updateActionButtonsState() {
            singleShotButton.disabled = personalScore < SINGLE_SHOT_COST;
            singleShotButton.title = singleShotButton.disabled ? `ØªØ­ØªØ§Ø¬ ${SINGLE_SHOT_COST} Ù‚Ø·Ø¹Ø© Ù†Ù‚Ø¯ÙŠØ© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… "Ø¶Ø±Ø¨Ø© ÙØ±Ø¯ÙŠØ©"` : '';

            tripleShotButton.disabled = personalScore < TRIPLE_SHOT_COST;
            tripleShotButton.title = tripleShotButton.disabled ? `ØªØ­ØªØ§Ø¬ ${TRIPLE_SHOT_COST} Ù‚Ø·Ø¹Ø© Ù†Ù‚Ø¯ÙŠØ© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… "Ø¶Ø±Ø¨Ø© Ø«Ù„Ø§Ø«ÙŠØ©"` : '';

            hammerShotButton.disabled = personalScore < HAMMER_SHOT_COST;
            hammerShotButton.title = hammerShotButton.disabled ? `ØªØ­ØªØ§Ø¬ ${HAMMER_SHOT_COST} Ù‚Ø·Ø¹Ø© Ù†Ù‚Ø¯ÙŠØ© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… "Ø¶Ø±Ø¨Ø© Ø§Ù„Ù…Ø·Ø±Ù‚Ø©"` : '';
        }

        // ÙˆØ¸ÙŠÙØ© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
        function generateBoxes() {
            boxesContainer.innerHTML = '';
            boxes = [];
            
            let boxValues = [];

            for (let i = 0; i < num10PointsBoxes; i++) {
                boxValues.push({ type: 'positive', value: 10 });
            }
            for (let i = 0; i < num5PointsBoxes; i++) {
                boxValues.push({ type: 'positive', value: 5 });
            }
            for (let i = 0; i < num1PointsBoxes; i++) {
                boxValues.push({ type: 'positive', value: 1 });
            }

            for (let i = 0; i < numNegative5PointsBoxes; i++) {
                boxValues.push({ type: 'negative', value: -5 });
            }
            for (let i = 0; i < numNegative10PointsBoxes; i++) {
                boxValues.push({ type: 'negative', value: -10 });
            }

            const totalSpecifiedBoxes = boxValues.length;

            if (totalSpecifiedBoxes > numBoxes) {
                boxValues = boxValues.slice(0, numBoxes);
                showMessage(`ØªÙ†Ø¨ÙŠÙ‡: Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„ØªÙŠ ØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ (${totalSpecifiedBoxes}) ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ (${numBoxes}). ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙˆÙ„ ${numBoxes} ØµÙ†Ø¯ÙˆÙ‚ ÙÙ‚Ø·.`, true);
            } else if (totalSpecifiedBoxes < numBoxes) {
                const remainingSlots = numBoxes - totalSpecifiedBoxes;
                // Ù‚Ù… Ø¨Ù…Ù„Ø¡ Ø§Ù„ÙØ±Ø§ØºØ§Øª Ø¨ØµÙ†Ø§Ø¯ÙŠÙ‚ +1 Ù†Ù‚Ø·Ø© Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ
                for (let i = 0; i < remainingSlots; i++) {
                    boxValues.push({ type: 'positive', value: 1 });
                }
                showMessage(`ØªÙ†Ø¨ÙŠÙ‡: ØªÙ… Ù…Ù„Ø¡ ${remainingSlots} ØµÙ†Ø¯ÙˆÙ‚ Ø¥Ø¶Ø§ÙÙŠ Ø¨Ù‚ÙŠÙ…Ø© +1 Ù‚Ø·Ø¹Ø© Ù†Ù‚Ø¯ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ ${numBoxes}.`);
            }

            for (let i = boxValues.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [boxValues[i], boxValues[j]] = [boxValues[j], boxValues[i]];
            }

            for (let i = 0; i < numBoxes; i++) {
                const box = document.createElement('div');
                box.classList.add('box');
                box.dataset.index = i;
                box.dataset.type = boxValues[i].type; 
                box.dataset.value = boxValues[i].value;
                
                const randomGlowColor = glowColors[Math.floor(Math.random() * glowColors.length)];
                box.style.setProperty('--glow-color', randomGlowColor);

                const img = document.createElement('img');
                img.src = 'box_closed.png';
                img.alt = 'ØµÙ†Ø¯ÙˆÙ‚';
                img.classList.add('box-image');
                box.appendChild(img);
                
                boxesContainer.appendChild(box);
                boxes.push(box);
            }
            // âœ… ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ù…Ù†Ø·Ù‚ Ø¥Ù†Ø´Ø§Ø¡/Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† seekerImage Ù…Ù† Ù‡Ù†Ø§
            // Ù„Ø£Ù†Ù‡ Ø£ØµØ¨Ø­ Ø¹Ù†ØµØ±Ù‹Ø§ Ø«Ø§Ø¨ØªÙ‹Ø§ ÙÙŠ HTML Ø®Ø§Ø±Ø¬ boxesContainer
        }

        // ÙˆØ¸ÙŠÙØ© ÙØªØ­ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ¥Ø®ÙØ§Ø¦Ù‡ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
        function openBox(boxElement) {
            if (boxElement.classList.contains('opened')) {
                return; 
            }

            const value = parseInt(boxElement.dataset.value);
            const type = boxElement.dataset.type;

            boxElement.classList.add('opened');
            boxElement.textContent = (value > 0 ? '+' : '') + value; 

            if (value === 10) {
                boxElement.classList.add('positive-score-10');
            } else if (value === 5) {
                boxElement.classList.add('positive-score-5');
            } else if (value === 1) {
                boxElement.classList.add('positive-score-1');
            } else if (value === -5) {
                boxElement.classList.add('negative-score-5');
            } else if (value === -10) {
                boxElement.classList.add('negative-score-10');
            }

            currentRoundPoints += value;
            personalScore += value;

            if (personalScore > highScore) {
                highScore = personalScore;
            }

            updateScoreBoard();

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ù…Ù† Ù…ØµÙÙˆÙØ© `boxes` (Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ù„ØªØªØ¨Ø¹ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©)
            // Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… `boxesContainer.children` Ù…Ø¨Ø§Ø´Ø±Ø© Ø§Ù„Ø¢Ù†ØŒ Ù‚Ø¯ Ù„Ø§ ÙŠÙƒÙˆÙ† Ù‡Ø°Ø§ Ø¶Ø±ÙˆØ±ÙŠÙ‹Ø§
            // ÙˆÙ„ÙƒÙ† Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØ³Ø§Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¢Ø®Ø± Ù„Ù„Ù…ØµÙÙˆÙØ©:
            const indexInBoxesArray = boxes.indexOf(boxElement);
            if (indexInBoxesArray > -1) {
                boxes.splice(indexInBoxesArray, 1);
            }

            // âœ… Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙˆØ±Ù‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ÙØªØ­
            let scoreMessage = '';
            if (value > 0) {
                scoreMessage = `${username} Ø­ØµÙ„ Ø¹Ù„Ù‰ +${value} Ù‚Ø·Ø¹Ø© Ù†Ù‚Ø¯ÙŠØ©!`; // ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„ØªØ¹ÙƒØ³ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
                showMessage(scoreMessage, false, true); // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ø¨Ù„ÙˆÙ† Ø£Ø®Ø¶Ø±
            } else if (value < 0) {
                scoreMessage = `${username} Ø®Ø³Ø± ${Math.abs(value)} Ù‚Ø·Ø¹Ø© Ù†Ù‚Ø¯ÙŠØ©!`; // ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„ØªØ¹ÙƒØ³ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
                showMessage(scoreMessage, true, false); // Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø¨Ù„ÙˆÙ† Ø£Ø­Ù…Ø±
            } else {
                scoreMessage = `${username} Ù„Ù… ÙŠØ¬Ø¯ Ù‚Ø·Ø¹Ù‹Ø§ Ù†Ù‚Ø¯ÙŠØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚.`; // ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„ØªØ¹ÙƒØ³ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
                showMessage(scoreMessage); // Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ø¯ÙŠØ©
            }

            // âœ… ÙŠØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ù…Ù† Ø§Ù„Ù€ DOM Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù‚ØµÙŠØ±Ø©
            setTimeout(() => {
                boxElement.style.transition = 'opacity 0.5s ease-out'; 
                boxElement.style.opacity = '0'; 
                setTimeout(() => {
                    if (boxElement.parentNode) {
                        boxElement.parentNode.removeChild(boxElement);
                    }
                }, 500); 
            }, 3000); 
        }

        // âœ… ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ø¤Ø´Ø± Ø¥Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚ Ù…Ø­Ø¯Ø¯
        function moveSeekerToBox(boxElement) {
            if (!boxElement) return;

            const boxRect = boxElement.getBoundingClientRect();
            const containerRect = boxesContainer.getBoundingClientRect();

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù†Ø³Ø¨ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
            const targetX = boxRect.left - containerRect.left + (boxRect.width / 2);
            const targetY = boxRect.top - containerRect.top + (boxRect.height / 2);

            seekerImage.style.left = `${targetX}px`;
            seekerImage.style.top = `${targetY}px`;
            seekerImage.style.display = 'flex'; // Use flex to keep text centered
        }

        // âœ… ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙˆÙ‡Ø¬ Ø§Ù„Ù…ØªØ³Ù„Ø³Ù„
        function startSequentialGlow(availableBoxes, onComplete) {
            stopSequentialGlow(); // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØªÙˆÙ‡Ø¬ Ø³Ø§Ø¨Ù‚
            let glowCount = 0;
            const totalGlows = Math.min(availableBoxes.length * 2, 30); // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„ØªÙˆÙ‡Ø¬
            sequentialGlowIndex = 0;

            sequentialGlowInterval = setInterval(() => {
                if (glowCount >= totalGlows) {
                    stopSequentialGlow();
                    onComplete();
                    return;
                }

                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙˆÙ‡Ø¬ Ù…Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø³Ø§Ø¨Ù‚
                if (sequentialGlowIndex > 0) {
                    availableBoxes[sequentialGlowIndex - 1].classList.remove('sequential-glow');
                } else if (availableBoxes.length > 0) {
                    availableBoxes[availableBoxes.length - 1].classList.remove('sequential-glow');
                }

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙ‡Ø¬ Ù„Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠ
                availableBoxes[sequentialGlowIndex].classList.add('sequential-glow');
                moveSeekerToBox(availableBoxes[sequentialGlowIndex]); // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ø¤Ø´Ø± Ù…Ø¹ Ø§Ù„ØªÙˆÙ‡Ø¬

                sequentialGlowIndex = (sequentialGlowIndex + 1) % availableBoxes.length;
                glowCount++;
            }, 150); // Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙˆÙ‡Ø¬
        }

        // âœ… ÙˆØ¸ÙŠÙØ© Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙˆÙ‡Ø¬ Ø§Ù„Ù…ØªØ³Ù„Ø³Ù„
        function stopSequentialGlow() {
            clearInterval(sequentialGlowInterval);
            sequentialGlowInterval = null;
            const glowingBoxes = document.querySelectorAll('.box.sequential-glow');
            glowingBoxes.forEach(box => box.classList.remove('sequential-glow'));
        }

        // âœ… ÙˆØ¸ÙŠÙØ© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆÙ‡Ø¬
        function selectFinalBoxes(availableBoxes, count, onBoxSelected) {
            if (availableBoxes.length === 0) return;

            const finalBox = availableBoxes[sequentialGlowIndex]; // Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø°ÙŠ ØªÙˆÙ‚Ù Ø¹Ù†Ø¯Ù‡ Ø§Ù„ØªÙˆÙ‡Ø¬
            finalBox.classList.add('single-shot-final-glow');
            seekerImage.style.animation = 'finalSeekerPulse 0.5s infinite alternate'; // ØªÙˆÙ‡Ø¬ Ø§Ù„Ù…Ø¤Ø´Ø±

            setTimeout(() => {
                onBoxSelected(finalBox);
                finalBox.classList.remove('single-shot-final-glow');
                seekerImage.style.animation = ''; // Ø¥ÙŠÙ‚Ø§Ù ØªÙˆÙ‡Ø¬ Ø§Ù„Ù…Ø¤Ø´Ø±
                seekerImage.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¤Ø´Ø±
                enableAllActionButtons(); // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            }, 2000); // Ø§Ù†ØªØ¸Ø± Ø«Ø§Ù†ÙŠØªÙŠÙ† Ù‚Ø¨Ù„ ÙØªØ­ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
        }

        // ÙˆØ¸ÙŠÙØ© Ø¨Ø¯Ø¡ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function startNewRound() {
            roundNumber++;
            currentRoundPoints = 0;
            showMessage(`Ø§Ù„Ø¬ÙˆÙ„Ø© ${roundNumber} Ø¨Ø¯Ø£Øª! Ø­Ø¸Ù‹Ø§ Ù…ÙˆÙÙ‚Ù‹Ø§ ÙŠØ§ ${username}!`);
            generateBoxes();
            updateScoreBoard();
            enableAllActionButtons();
        }

        // ÙˆØ¸ÙŠÙØ© Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        async function startGame() {
            await fetchUsername(); // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
            startNewRound();
        }

        // ÙˆØ¸ÙŠÙØ© Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© (Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø¨Ø§ÙƒÙ†Ø¯)
        function saveGameData() {
            const gameData = {
                username: username,
                personalScore: personalScore,
                highScore: highScore,
                roundNumber: roundNumber,
                singleShotsUsed: singleShotsUsed,
                tripleShotsUsed: tripleShotsUsed,
                hammerShotsUsed: hammerShotsUsed,
                date: new Date().toISOString()
            };
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            localStorage.setItem(`gameData_${username}`, JSON.stringify(gameData));
            // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø¨Ø§ÙƒÙ†Ø¯
            const token = localStorage.getItem('token'); // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªÙˆÙƒÙ† ÙÙ‚Ø·
            if (token) {
                fetch('/api/users/save-game-score', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({
                        personalScore,
                        highScore,
                        roundNumber,
                        singleShotsUsed,
                        tripleShotsUsed,
                        hammerShotsUsed
                    })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!', data.stats);
                    } else {
                        console.error('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©:', data.message);
                    }
                })
                .catch(err => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±:', err);
                });
            } else {
                console.warn('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆÙƒÙ† JWTØŒ Ù„Ù† ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!');
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
        async function fetchUsername() {
            const token = localStorage.getItem('token');
            if (!token) {
                showMessage('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹! Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„...', true);
                disableAllActionButtons();
                setTimeout(() => { window.location.href = 'index.html'; }, 2000);
                throw new Error('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆÙƒÙ† JWT');
            }
            try {
                const res = await fetch('/api/users/me', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                if (!res.ok) {
                    showMessage('ÙØ´Ù„ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…. Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„...', true);
                    disableAllActionButtons();
                    setTimeout(() => { window.location.href = 'index.html'; }, 2000);
                    throw new Error('ÙØ´Ù„ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                }
                const data = await res.json();
                if (!data.username) {
                    showMessage('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª! Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„...', true);
                    disableAllActionButtons();
                    setTimeout(() => { window.location.href = 'index.html'; }, 2000);
                    throw new Error('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                }
                username = data.username;
                usernameDisplay.textContent = username;
                enableAllActionButtons();
            } catch (err) {
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…! Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„...', true);
                disableAllActionButtons();
                setTimeout(() => { window.location.href = 'index.html'; }, 2000);
                throw err;
            }
        }

        // Ù…Ø³ØªÙ…Ø¹Ùˆ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        document.addEventListener('DOMContentLoaded', () => {
            startGame();

            singleShotButton.addEventListener('click', () => {
                if (personalScore < SINGLE_SHOT_COST) {
                    showMessage('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ù‚Ø·Ø¹ Ù†Ù‚Ø¯ÙŠØ© ÙƒØ§ÙÙŠØ©!', true);
                    return;
                }
                personalScore -= SINGLE_SHOT_COST;
                singleShotsUsed++;
                updateScoreBoard();
                disableAllActionButtons();
                showMessage('ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ØµÙ†Ø¯ÙˆÙ‚ Ø¹Ø´ÙˆØ§Ø¦ÙŠ...');

                const availableBoxes = Array.from(boxesContainer.children).filter(b => !b.classList.contains('opened'));
                if (availableBoxes.length === 0) {
                    showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ù…ØªØ¨Ù‚ÙŠØ©!', true);
                    enableAllActionButtons();
                    return;
                }

                startSequentialGlow(availableBoxes, () => {
                    selectFinalBoxes(availableBoxes, 1, (box) => {
                        playSound(winSound, 'Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ÙÙˆØ²');
                        openBox(box);
                    });
                });
            });

            tripleShotButton.addEventListener('click', () => {
                if (personalScore < TRIPLE_SHOT_COST) {
                    showMessage('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ù‚Ø·Ø¹ Ù†Ù‚Ø¯ÙŠØ© ÙƒØ§ÙÙŠØ©!', true);
                    return;
                }
                personalScore -= TRIPLE_SHOT_COST;
                tripleShotsUsed++;
                updateScoreBoard();
                disableAllActionButtons();
                showMessage('ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ 3 ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©...');

                const availableBoxes = Array.from(boxesContainer.children).filter(b => !b.classList.contains('opened'));
                if (availableBoxes.length < 3) {
                    showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙ†Ø§Ø¯ÙŠÙ‚ ÙƒØ§ÙÙŠØ© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¶Ø±Ø¨Ø©!', true);
                    personalScore += TRIPLE_SHOT_COST; // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø¨Ù„Øº
                    tripleShotsUsed--;
                    updateScoreBoard();
                    enableAllActionButtons();
                    return;
                }

                startSequentialGlow(availableBoxes, () => {
                    // ØªØ­Ø¯ÙŠØ¯ 3 ØµÙ†Ø§Ø¯ÙŠÙ‚ ÙØ±ÙŠØ¯Ø©
                    const finalIndices = new Set();
                    while(finalIndices.size < 3) {
                        const randomIndex = Math.floor(Math.random() * availableBoxes.length);
                        finalIndices.add(randomIndex);
                    }

                    let delay = 0;
                    finalIndices.forEach(index => {
                        const box = availableBoxes[index];
                        setTimeout(() => {
                            moveSeekerToBox(box);
                            box.classList.add('single-shot-final-glow');
                            setTimeout(() => {
                                playSound(winSound, 'Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ÙÙˆØ²');
                                openBox(box);
                                box.classList.remove('single-shot-final-glow');
                            }, 1000);
                        }, delay);
                        delay += 1200;
                    });

                    setTimeout(() => {
                        seekerImage.style.display = 'none';
                        enableAllActionButtons();
                    }, delay);
                });
            });

            hammerShotButton.addEventListener('click', () => {
                if (personalScore < HAMMER_SHOT_COST) {
                    showMessage('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ù‚Ø·Ø¹ Ù†Ù‚Ø¯ÙŠØ© ÙƒØ§ÙÙŠØ©!', true);
                    return;
                }
                personalScore -= HAMMER_SHOT_COST;
                hammerShotsUsed++;
                updateScoreBoard();
                disableAllActionButtons();
                showMessage('Ø¶Ø±Ø¨Ø© Ø§Ù„Ù…Ø·Ø±Ù‚Ø©! ÙŠØªÙ… ÙØªØ­ Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚...');

                const availableBoxes = Array.from(boxesContainer.children).filter(b => !b.classList.contains('opened'));
                const boxesToOpenCount = Math.min(availableBoxes.length, HAMMER_SHOT_BOXES);

                if (boxesToOpenCount === 0) {
                    showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ù…ØªØ¨Ù‚ÙŠØ©!', true);
                    personalScore += HAMMER_SHOT_COST;
                    hammerShotsUsed--;
                    updateScoreBoard();
                    enableAllActionButtons();
                    return;
                }

                // Ø®Ù„Ø· Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…ØªØ§Ø­Ø©
                for (let i = availableBoxes.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [availableBoxes[i], availableBoxes[j]] = [availableBoxes[j], availableBoxes[i]];
                }

                const boxesToOpen = availableBoxes.slice(0, boxesToOpenCount);
                let delay = 0;
                boxesToOpen.forEach(box => {
                    setTimeout(() => {
                        moveSeekerToBox(box);
                        box.classList.add('single-shot-final-glow');
                        setTimeout(() => {
                            playSound(winSound, 'Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ÙÙˆØ²');
                            openBox(box);
                            box.classList.remove('single-shot-final-glow');
                        }, 500);
                    }, delay);
                    delay += 200; // ÙØªØ­ Ø³Ø±ÙŠØ¹ ÙˆÙ…ØªØªØ§Ù„ÙŠ
                });

                setTimeout(() => {
                    seekerImage.style.display = 'none';
                    enableAllActionButtons();
                }, delay + 500);
            });

            logoutButton.addEventListener('click', () => {
                saveGameData();
                localStorage.removeItem('username');
                window.location.href = 'index.html';
            });

            volumeSlider.addEventListener('input', updateVolumeFromSlider);
            increaseVolumeBtn.addEventListener('click', increaseVolume);
            decreaseVolumeBtn.addEventListener('click', decreaseVolume);
            muteToggleBtn.addEventListener('click', toggleMute);

            window.addEventListener('beforeunload', saveGameData);
        });

    </script>
</body>
</html>