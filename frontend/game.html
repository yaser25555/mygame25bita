<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoiceBoom Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Scheherazade+New:wght@400;700&family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="mobile-optimization.css">
    <link rel="stylesheet" href="box-styles.css">
    <link rel="stylesheet" href="game-styles.css">
</head>
<body>
    <!-- Ø²Ø± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ -->
    <button id="darkModeToggle" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ/Ø§Ù„ÙØ§ØªØ­">ğŸŒ™</button>
    <!-- Ø²Ø± ØºØ±ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ØµÙˆØªÙŠØ© -->
    <button onclick="window.open('voice-chat-room.html', '_blank')" 
        style="
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 9999;
            background: linear-gradient(135deg, #7fbcff 0%, #4f46e5 100%);
            color: #fff;
            border: none;
            border-radius: 50px;
            box-shadow: 0 4px 16px rgba(79,70,229,0.18);
            font-size: 1.2em;
            font-family: 'Cairo', 'Noto Naskh Arabic', sans-serif;
            padding: 18px 32px;
            cursor: pointer;
            font-weight: bold;
            letter-spacing: 1px;
            transition: background 0.2s, transform 0.2s;
        "
        onmouseover="this.style.background='linear-gradient(135deg, #f43f5e 0%, #facc15 100%)'"
        onmouseout="this.style.background='linear-gradient(135deg, #7fbcff 0%, #4f46e5 100%)'"
    >
        ğŸ¤ ØºØ±ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ØµÙˆØªÙŠØ©
    </button>
    <div class="main-content">
        <!-- Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (ÙŠÙ…ÙŠÙ†) -->
        <div class="messages-column">
            <div class="message-area" id="message-area"></div>
        </div>
        <!-- Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù„Ø¹Ø¨Ø© (ÙˆØ³Ø·) -->
        <div class="game-center-column">
            <div class="header-container">
                <div class="centered-header-content">
                    <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù„Ø¹Ø¨Ø©" class="logo small-logo">
                </div>
            </div>
            <div class="controls circular-controls">
                <button id="single-shot-button" class="bet-button circular-btn" title="Ø¶Ø±Ø¨Ø© ÙØ±Ø¯ÙŠØ©">
                    <i class="fas fa-crosshairs"></i>
                </button>
                <button id="triple-shot-button" class="bet-button circular-btn" title="Ø¶Ø±Ø¨Ø© Ø«Ù„Ø§Ø«ÙŠØ©">
                    <i class="fas fa-bullseye"></i>
                </button>
                <button id="hammer-shot-button" class="bet-button circular-btn" title="Ø¶Ø±Ø¨Ø© Ø§Ù„Ù…Ø·Ø±Ù‚Ø©">
                    <i class="fas fa-hammer"></i>
                </button>
            </div>
            <div class="item-collection-display large-items" id="itemCollectionDisplay">
                <div class="item-collection-title">
                    ğŸ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©
                    <button id="itemInfoBtn" class="item-info-btn" title="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù†Ø§ØµØ±">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
                <div class="items-grid" id="itemsGrid"></div>
                <div class="collection-reward" id="collectionReward" style="display: none;">
                    ğŸ‰ Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©!
                </div>
            </div>
            <div class="boxes-grid prominent-boxes" id="boxes-container"></div>
            <div id="seeker-hero"></div>
        </div>
        <!-- Ø¹Ù…ÙˆØ¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (ÙŠØ³Ø§Ø±) -->
        <div class="left-panel">
    <div class="player-info">
        <div class="player-details">
            <p><span id="username-display"></span></p>
            <p><span id="balance-display"></span>ğŸ’°</p>
                    <p><span id="pearl-balance"></span>ğŸ¦ª</p>
        </div>
        <div class="player-actions">
            <button id="recharge-button" title="ØªØ¹Ø¨Ø¦Ø© Ø±ØµÙŠØ¯">ğŸ’°</button>
                    <button id="lamp-button" title="ÙØªØ­ Ø§Ù„Ù…ØµØ¨Ø§Ø­">ğŸ’¡</button>
            <button id="logout-button" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬">â»</button>
            <button id="mute-button" title="ÙƒØªÙ…/Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ø§Ù„ØµÙˆØª">ğŸ”Š</button>
            <button id="friendsBtn" title="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡">ğŸ‘¥</button>
            <button id="dailyQuestsBtn" title="Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©">ğŸ“‹</button>
            <button id="inviteBtn" title="Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹ÙˆØ§Øª">ğŸ</button>
        </div>
    </div>
        <div class="chat-container" id="chatContainer">
            <div class="chat-header">
                <h3><i class="fas fa-comments"></i> Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h3>
                <div class="chat-controls">
                    <button id="reconnectBtn" class="chat-control-btn" title="Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„" style="background: linear-gradient(135deg, #10b981, #059669);">
                        <i class="fas fa-wifi"></i>
                    </button>
                    <button id="voiceChatBtn" class="chat-control-btn" title="Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ØµÙˆØªÙŠØ©">
                        <i class="fas fa-microphone-slash"></i>
                    </button>
                    <button id="chatMuteBtn" class="chat-control-btn" title="ÙƒØªÙ… ØµÙˆØª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    <button id="toggleChat" class="chat-toggle-btn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
            </div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="system-message">
                    <span class="message-time">Ø§Ù„Ø¢Ù†</span>
                    <span class="message-text">Ù…Ø±Ø­Ø¨Ø§Ù‹! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ù‡Ù†Ø§</span>
                </div>
            </div>
            <div class="voice-chat-status" id="voiceChatStatus" style="display: none;">
                <div class="voice-indicator">
                    <i class="fas fa-microphone"></i>
                    <span>Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ØµÙˆØªÙŠØ© Ù†Ø´Ø·Ø©</span>
                </div>
                <div class="connected-players" id="connectedPlayers">
                    <span>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†: 0</span>
                </div>
            </div>
            <div class="chat-input-container">
                <div class="chat-controls-row" style="position: relative;">
                        <button id="emojiBtn" class="emoji-btn" title="Ø¥Ø¶Ø§ÙØ© Ø±Ù…Ø² ØªØ¹Ø¨ÙŠØ±ÙŠ">ğŸ˜Š</button>
                    <div id="emojiPicker" class="emoji-picker">
                        <div class="emoji-item">ğŸ˜Š</div>
                        <div class="emoji-item">ğŸ˜‚</div>
                        <div class="emoji-item">ğŸ‰</div>
                        <div class="emoji-item">ğŸ†</div>
                        <div class="emoji-item">ğŸ’°</div>
                        <div class="emoji-item">ğŸ®</div>
                        <div class="emoji-item">ğŸ”¥</div>
                        <div class="emoji-item">â­</div>
                        <div class="emoji-item">ğŸ’ª</div>
                        <div class="emoji-item">ğŸ¯</div>
                        <div class="emoji-item">ğŸŠ</div>
                        <div class="emoji-item">ğŸ¥³</div>
                        <div class="emoji-item">ğŸ˜</div>
                        <div class="emoji-item">ğŸ¤©</div>
                        <div class="emoji-item">ğŸ‘</div>
                        <div class="emoji-item">ğŸª</div>
                        <div class="emoji-item">ğŸ¨</div>
                        <div class="emoji-item">ğŸŒŸ</div>
                        <div class="emoji-item">âœ¨</div>
                        <div class="emoji-item">ğŸ’</div>
                        <div class="emoji-item">ğŸ­</div>
                        <div class="emoji-item">ğŸª</div>
                        <div class="emoji-item">ğŸ¯</div>
        </div>
    </div>
                <div class="chat-controls-row" style="position: relative;">
                        <button id="soundBtn" class="sound-btn" title="Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØµÙˆØª">ğŸ”Š</button>
                    <div id="soundKeys" class="sound-keys">
                        <div class="sound-key" data-sound="win">ğŸ‰ ÙÙˆØ²</div>
                        <div class="sound-key" data-sound="lose">ğŸ˜¢ Ø®Ø³Ø§Ø±Ø©</div>
                        <div class="sound-key" data-sound="click">ğŸ‘† Ù†Ù‚Ø±Ø©</div>
                        <div class="sound-key" data-sound="single">ğŸ¯ Ø¶Ø±Ø¨Ø© ÙØ±Ø¯ÙŠØ©</div>
                        <div class="sound-key" data-sound="triple">ğŸ¯ Ø¶Ø±Ø¨Ø© Ø«Ù„Ø§Ø«ÙŠØ©</div>
                        <div class="sound-key" data-sound="hammer">ğŸ”¨ Ø¶Ø±Ø¨Ø© Ø§Ù„Ù…Ø·Ø±Ù‚Ø©</div>
            </div>
            </div>
                <input type="text" id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." maxlength="100">
                <button id="sendMessage" class="send-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
                </div>
            </div>
        </div>
    </div>

    <div id="loading-indicator">Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>

    <!-- Voice Chat Modal -->
    <div class="voice-modal" id="voiceModal">
        <div class="voice-modal-content">
            <h3><i class="fas fa-microphone"></i> Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ØµÙˆØªÙŠØ©</h3>
            <p>Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ØµÙˆØªÙŠØ©ØŒ Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ø°Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†</p>
            <button id="enableVoiceBtn" class="voice-permission-btn">
                <i class="fas fa-microphone"></i> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†
            </button>
            <button id="cancelVoiceBtn" class="voice-permission-btn" style="background: #6b7280;">
                Ø¥Ù„ØºØ§Ø¡
            </button>
        </div>
    </div>

    <div id="win-gif-container">
        <button class="close-btn" id="closeWinGif">Ã—</button>
        <img src="WIN.GIF" alt="Win GIF">
        <div id="win-amount-display" style="display: none;">
            <span id="win-amount-text"></span>
        </div>
    </div>

    <div id="sadcat-gif-container">
        <button class="close-btn" id="closeSadcatGif">Ã—</button>
        <img src="sadcat.gif" alt="Sadcat GIF">
        <div id="lose-amount-display" style="display: none;">
            <span id="lose-amount-text"></span>
        </div>
    </div>

    <audio id="winSound" src="win.mp3"></audio>
    <audio id="loseSound" src="lose.mp3"></audio>
    <audio id="buttonClick" src="click.mp3"></audio>
    <audio id="winGifSound" src="WIN1.MP3"></audio>
    <audio id="loseGifSound" src="lose.mp3"></audio>
    
    <!-- Chat Audio -->
    <audio id="chatNotification" src="sounds/click.mp3"></audio>
    <audio id="messageSent" src="click.mp3"></audio>

    <!-- Item Info Modal -->
    <div class="item-info-modal" id="itemInfoModal">
        <div class="item-info-content">
            <div class="item-info-header">
                <h2 class="item-info-title">ğŸ“š Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ±</h2>
                <button class="item-info-close" id="itemInfoClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="item-info-grid" id="itemInfoGrid">
                <!-- Items will be generated by JavaScript -->
            </div>
            
            <div class="collection-goals-section">
                <h3 class="collection-goals-title">ğŸ¯ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</h3>
                <div class="collection-goals-list" id="collectionGoalsList">
                    <!-- Goals will be generated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <div class="player-stats-panel" style="margin: 30px 0;">
      <h3 style="text-align:center;">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ</h3>
      <canvas id="playerStatsChart" width="400" height="220" style="max-width:100%;background:#fff;border-radius:12px;"></canvas>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ -->
    <div id="friendsModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:10001;justify-content:center;align-items:center;">
      <div style="background:#fff;padding:30px 20px;border-radius:18px;max-width:400px;width:95vw;position:relative;direction:rtl;">
        <button id="closeFriendsModal" style="position:absolute;top:10px;left:10px;background:none;border:none;font-size:1.5em;cursor:pointer;">Ã—</button>
        <h2 style="text-align:center;">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h2>
        <div id="friendsList" style="margin:15px 0 20px 0;min-height:40px;"></div>
        <form id="addFriendForm" style="display:flex;gap:8px;">
          <input type="text" id="addFriendInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¥Ø¶Ø§ÙØªÙ‡" style="flex:1;padding:8px;border-radius:6px;border:1px solid #ccc;">
          <button type="submit" style="padding:8px 16px;border-radius:6px;background:#4f46e5;color:#fff;border:none;">Ø¥Ø¶Ø§ÙØ©</button>
        </form>
        <div id="friendActionMsg" style="margin-top:10px;color:#10b981;text-align:center;"></div>
      </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
    <div id="dailyQuestsModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:10001;justify-content:center;align-items:center;">
      <div style="background:#fff;padding:30px 20px;border-radius:18px;max-width:500px;width:95vw;position:relative;direction:rtl;max-height:80vh;overflow-y:auto;">
        <button id="closeDailyQuestsModal" style="position:absolute;top:10px;left:10px;background:none;border:none;font-size:1.5em;cursor:pointer;">Ã—</button>
        <h2 style="text-align:center;">ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>
        <div id="dailyQuestsList" style="margin:15px 0 20px 0;min-height:40px;"></div>
        <div id="dailyQuestsMsg" style="margin-top:10px;color:#10b981;text-align:center;"></div>
      </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹ÙˆØ§Øª -->
    <div id="inviteModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:10001;justify-content:center;align-items:center;">
      <div style="background:#fff;padding:30px 20px;border-radius:18px;max-width:500px;width:95vw;position:relative;direction:rtl;max-height:80vh;overflow-y:auto;">
        <button id="closeInviteModal" style="position:absolute;top:10px;left:10px;background:none;border:none;font-size:1.5em;cursor:pointer;">Ã—</button>
        <h2 style="text-align:center;">ğŸ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹ÙˆØ§Øª</h2>
        
        <!-- ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø®Ø§Øµ -->
        <div style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:20px;border-radius:12px;margin:15px 0;text-align:center;">
          <h3 style="margin:0 0 10px 0;">ÙƒÙˆØ¯ Ø¯Ø¹ÙˆØªÙƒ Ø§Ù„Ø®Ø§Øµ</h3>
          <div id="inviteCode" style="font-size:24px;font-weight:bold;letter-spacing:2px;background:rgba(255,255,255,0.2);padding:10px;border-radius:8px;margin:10px 0;">
            ...Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„
          </div>
          <button id="copyInviteCode" style="background:rgba(255,255,255,0.2);border:2px solid white;color:white;padding:8px 16px;border-radius:6px;cursor:pointer;margin-top:10px;">
            ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯
          </button>
        </div>
        
        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯Ø¹ÙˆØ§Øª -->
        <div style="background:#f3f4f6;padding:15px;border-radius:10px;margin:15px 0;">
          <h4 style="margin:0 0 10px 0;">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¯Ø¹ÙˆØ§ØªÙƒ</h4>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
            <div style="text-align:center;">
              <div id="totalInvited" style="font-size:20px;font-weight:bold;color:#4f46e5;">0</div>
              <div style="font-size:12px;color:#666;">Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¯Ø¹ÙˆØªÙ‡Ù…</div>
            </div>
            <div style="text-align:center;">
              <div id="totalRewards" style="font-size:20px;font-weight:bold;color:#10b981;">0</div>
              <div style="font-size:12px;color:#666;">Ù†Ù‚Ø·Ø© Ù…ÙƒØ§ÙØ£Ø©</div>
            </div>
          </div>
        </div>
        
        <!-- Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙˆØ¯ Ø¯Ø¹ÙˆØ© -->
        <div style="background:#f0f9ff;padding:15px;border-radius:10px;margin:15px 0;">
          <h4 style="margin:0 0 10px 0;">ğŸ”‘ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙˆØ¯ Ø¯Ø¹ÙˆØ©</h4>
          <form id="useInviteForm" style="display:flex;gap:8px;">
            <input type="text" id="useInviteInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ©" style="flex:1;padding:8px;border-radius:6px;border:1px solid #ccc;text-transform:uppercase;">
            <button type="submit" style="padding:8px 16px;border-radius:6px;background:#10b981;color:#fff;border:none;">Ø§Ø³ØªØ®Ø¯Ø§Ù…</button>
          </form>
        </div>
        
        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¯Ø¹ÙˆÙŠÙ† -->
        <div id="invitedUsersList" style="margin:15px 0;">
          <h4 style="margin:0 0 10px 0;">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† Ø¯Ø¹ÙˆØªÙ‡Ù…</h4>
          <div id="invitedUsers" style="max-height:200px;overflow-y:auto;">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
          </div>
        </div>
        
        <div id="inviteMsg" style="margin-top:10px;color:#10b981;text-align:center;"></div>
      </div>
    </div>

    <!-- Ù‚Ø¨Ù„ ÙˆØ³Ù… </body> Ù…Ø¨Ø§Ø´Ø±Ø© Ø£Ø¶Ù: -->
    <script src="game.js"></script>
    <script src="daily-quests.js"></script>
    <script>
    // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­Ø³Ø¨ ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.body.classList.add('dark-mode');
    }
    // Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
    const darkModeToggle = document.getElementById('darkModeToggle');
    darkModeToggle.onclick = function() {
      document.body.classList.toggle('dark-mode');
      // Ø­ÙØ¸ Ø§Ù„ØªÙØ¶ÙŠÙ„ ÙÙŠ localStorage
      if(document.body.classList.contains('dark-mode')) {
        localStorage.setItem('darkMode', '1');
      } else {
        localStorage.removeItem('darkMode');
      }
    };
    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ØªÙØ¶ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
    if(localStorage.getItem('darkMode')) {
      document.body.classList.add('dark-mode');
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¯ÙˆÙ† Chart.js
    function displayPlayerStats(stats) {
      const statsContainer = document.getElementById('playerStatsChart');
      if (!statsContainer) return;
      
      try {
        statsContainer.innerHTML = `
          <div style="
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
            margin: 20px 0;
          ">
            <h3 style="margin: 0 0 15px 0; font-size: 1.2em;">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px;">
              <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px;">
                <div style="font-size: 1.5em; font-weight: bold;">${stats.score || 0}</div>
                <div style="font-size: 0.9em;">Ø§Ù„Ù†Ù‚Ø§Ø·</div>
              </div>
              <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px;">
                <div style="font-size: 1.5em; font-weight: bold;">${stats.boxesOpened || 0}</div>
                <div style="font-size: 0.9em;">Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</div>
              </div>
              <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px;">
                <div style="font-size: 1.5em; font-weight: bold;">${stats.itemsCollected?.gem || 0}</div>
                <div style="font-size: 0.9em;">Ø§Ù„Ø¬ÙˆØ§Ù‡Ø± ğŸ’</div>
              </div>
              <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px;">
                <div style="font-size: 1.5em; font-weight: bold;">${stats.itemsCollected?.key || 0}</div>
                <div style="font-size: 0.9em;">Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ğŸ”‘</div>
              </div>
              <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px;">
                <div style="font-size: 1.5em; font-weight: bold;">${stats.itemsCollected?.pearl || 0}</div>
                <div style="font-size: 0.9em;">Ø§Ù„Ù„Ø¢Ù„Ø¦ ğŸ¦ª</div>
              </div>
              <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px;">
                <div style="font-size: 1.5em; font-weight: bold;">${stats.itemsCollected?.star || 0}</div>
                <div style="font-size: 0.9em;">Ø§Ù„Ù†Ø¬ÙˆÙ… â­</div>
              </div>
            </div>
          </div>
        `;
      } catch (e) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', e);
      }
    }
    
    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
    const origUpdateDisplay = window.updateDisplay;
    window.updateDisplay = function() {
      try {
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        displayPlayerStats({
          score: window.score || 0,
          boxesOpened: window.itemsCollected?.boxesOpened || 0,
          itemsCollected: window.itemsCollected || {}
        });
        
        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ updateDisplay Ø§Ù„Ø£ØµÙ„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        if(origUpdateDisplay && origUpdateDisplay !== window.updateDisplay) {
          origUpdateDisplay();
        }
      } catch (e) {
        console.error('Ø®Ø·Ø£ ÙÙŠ updateDisplay:', e);
      }
    };
    
    // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    window.addEventListener('DOMContentLoaded',()=>{
      try {
        displayPlayerStats({
          score: window.score || 0,
          boxesOpened: window.itemsCollected?.boxesOpened || 0,
          itemsCollected: window.itemsCollected || {}
        });
      } catch (e) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠ:', e);
      }
    });

    const friendsBtn = document.getElementById('friendsBtn');
    const friendsModal = document.getElementById('friendsModal');
    const closeFriendsModal = document.getElementById('closeFriendsModal');
    const friendsListDiv = document.getElementById('friendsList');
    const addFriendForm = document.getElementById('addFriendForm');
    const addFriendInput = document.getElementById('addFriendInput');
    const friendActionMsg = document.getElementById('friendActionMsg');

    friendsBtn.onclick = () => {
      friendsModal.style.display = 'flex';
      loadFriendsList();
    };
    closeFriendsModal.onclick = () => {
      friendsModal.style.display = 'none';
      friendActionMsg.textContent = '';
    };
    window.onclick = function(e) {
      if(e.target === friendsModal) friendsModal.style.display = 'none';
    };

    async function loadFriendsList() {
      friendsListDiv.innerHTML = '...Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„';
      const token = localStorage.getItem('token');
      if(!token) return friendsListDiv.innerHTML = 'ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
      try {
        const res = await fetch(`${BACKEND_URL}/api/users/friends`, { headers: { 'Authorization': `Bearer ${token}` } });
        const data = await res.json();
        if(data.friends && data.friends.length) {
          friendsListDiv.innerHTML = data.friends.map(friend => `
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
              <span style="flex:1;">${friend}</span>
              <button onclick="removeFriend('${friend}')" style="background:#ef4444;color:#fff;border:none;border-radius:5px;padding:3px 10px;cursor:pointer;">Ø­Ø°Ù</button>
              <button onclick="inviteFriend('${friend}')" style="background:#10b981;color:#fff;border:none;border-radius:5px;padding:3px 10px;cursor:pointer;">Ø¯Ø¹ÙˆØ©</button>
            </div>
          `).join('');
        } else {
          friendsListDiv.innerHTML = '<span style="color:#888">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¨Ø¹Ø¯</span>';
        }
      } catch(e) {
        friendsListDiv.innerHTML = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡';
      }
    }

    addFriendForm.onsubmit = async function(e) {
      e.preventDefault();
      const username = addFriendInput.value.trim();
      if(!username) return;
      const token = localStorage.getItem('token');
      try {
        const res = await fetch(`${BACKEND_URL}/api/users/friends/add`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify({ friendUsername: username })
        });
        const data = await res.json();
        if(res.ok) {
          friendActionMsg.textContent = 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµØ¯ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­';
          addFriendInput.value = '';
          loadFriendsList();
        } else {
          friendActionMsg.textContent = data.message || 'ØªØ¹Ø°Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµØ¯ÙŠÙ‚';
        }
      } catch(e) {
        friendActionMsg.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…';
      }
    };

    window.removeFriend = async function(friendUsername) {
      const token = localStorage.getItem('token');
      try {
        const res = await fetch(`${BACKEND_URL}/api/users/friends/remove`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify({ friendUsername })
        });
        const data = await res.json();
        if(res.ok) {
          friendActionMsg.textContent = 'ØªÙ… Ø­Ø°Ù Ø§Ù„ØµØ¯ÙŠÙ‚';
          loadFriendsList();
        } else {
          friendActionMsg.textContent = data.message || 'ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„ØµØ¯ÙŠÙ‚';
        }
      } catch(e) {
        friendActionMsg.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…';
      }
    };

    window.inviteFriend = function(friendUsername) {
      // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„ØºØ±Ù Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¹Ø¨Ø± WebSocket
      alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¯Ø¹ÙˆØ© Ø¥Ù„Ù‰ ' + friendUsername + ' (ØªØ¬Ø±ÙŠØ¨ÙŠ)');
    };

    // ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
    let dailyQuestSystem = null;
    let notificationSystem = null;

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('DOMContentLoaded', () => {
        // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹)
        try {
            if (typeof NotificationSystem !== 'undefined') {
                notificationSystem = new NotificationSystem();
            }
        } catch (e) {
            console.log('Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±');
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹)
        try {
            if (typeof DailyQuestSystem !== 'undefined') {
                dailyQuestSystem = new DailyQuestSystem();
            }
        } catch (e) {
            console.log('Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ØºÙŠØ± Ù…ØªÙˆÙØ±');
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
        setupDailyQuestsButtons();
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹ÙˆØ§Øª
        setupInviteSystem();
    });

    function setupDailyQuestsButtons() {
        const dailyQuestsBtn = document.getElementById('dailyQuestsBtn');
        const dailyQuestsModal = document.getElementById('dailyQuestsModal');
        const closeDailyQuestsModal = document.getElementById('closeDailyQuestsModal');
        const dailyQuestsList = document.getElementById('dailyQuestsList');
        const dailyQuestsMsg = document.getElementById('dailyQuestsMsg');

        dailyQuestsBtn.onclick = () => {
            dailyQuestsModal.style.display = 'flex';
            loadDailyQuests();
        };

        closeDailyQuestsModal.onclick = () => {
            dailyQuestsModal.style.display = 'none';
            dailyQuestsMsg.textContent = '';
        };

        window.onclick = function(e) {
            if(e.target === dailyQuestsModal) dailyQuestsModal.style.display = 'none';
            if(e.target === friendsModal) friendsModal.style.display = 'none';
        };

        async function loadDailyQuests() {
            dailyQuestsList.innerHTML = '...Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„';
            try {
                if (!dailyQuestSystem) {
                    dailyQuestsList.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
                    return;
                }
                
                const activeQuests = dailyQuestSystem.getActiveQuests();
                const completedCount = dailyQuestSystem.getCompletedQuestsCount();
                const totalCount = dailyQuestSystem.getTotalQuestsCount();

                dailyQuestsList.innerHTML = `
                    <div style="
                        background: rgba(79, 70, 229, 0.1);
                        padding: 15px;
                        border-radius: 10px;
                        margin-bottom: 20px;
                        text-align: center;
                    ">
                        <div style="font-size: 18px; margin-bottom: 10px;">
                            Ø§Ù„ØªÙ‚Ø¯Ù…: ${completedCount}/${totalCount} Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø©
                        </div>
                        <div style="
                            background: rgba(255,255,255,0.2);
                            height: 10px;
                            border-radius: 5px;
                            overflow: hidden;
                        ">
                            <div style="
                                background: linear-gradient(90deg, #10b981, #059669);
                                height: 100%;
                                width: ${(completedCount / totalCount) * 100}%;
                                transition: width 0.3s ease;
                            "></div>
                        </div>
                    </div>

                    <div style="display: grid; gap: 15px;">
                        ${activeQuests.map(quest => `
                            <div style="
                                background: ${quest.completed ? 'rgba(16, 185, 129, 0.3)' : 'rgba(255,255,255,0.1)'};
                                padding: 15px;
                                border-radius: 10px;
                                border: 2px solid ${quest.completed ? '#10b981' : 'transparent'};
                            ">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 24px;">${quest.icon}</span>
                                        <div>
                                            <h3 style="margin: 0; font-size: 16px;">${quest.title}</h3>
                                            <p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.8;">
                                                ${quest.description.replace('{target}', quest.target)}
                                            </p>
                                        </div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 18px; font-weight: bold;">${quest.reward}</div>
                                        <div style="font-size: 12px;">Ù†Ù‚Ø·Ø©</div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 10px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span style="font-size: 12px;">Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                                        <span style="font-size: 12px;">${quest.progress}/${quest.target}</span>
                                    </div>
                                    <div style="
                                        background: rgba(255,255,255,0.2);
                                        height: 8px;
                                        border-radius: 4px;
                                        overflow: hidden;
                                    ">
                                        <div style="
                                            background: ${quest.completed ? '#10b981' : 'linear-gradient(90deg, #3b82f6, #2563eb)'};
                                            height: 100%;
                                            width: ${quest.progressPercentage}%;
                                            transition: width 0.3s ease;
                                        "></div>
                                    </div>
                                </div>
                                
                                ${quest.completed ? `
                                    <div style="
                                        text-align: center;
                                        margin-top: 10px;
                                        color: #10b981;
                                        font-weight: bold;
                                    ">
                                        âœ… Ù…ÙƒØªÙ…Ù„Ø©
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
            } catch(e) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:', e);
                dailyQuestsList.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</div>';
            }
        }
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ø§Ù… Ø¹Ù†Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„Ø¹Ø¨Ø©
    function updateDailyQuests(eventType, data) {
        if (dailyQuestSystem) {
            dailyQuestSystem.updateQuestsFromGameEvents(eventType, data);
        }
    }

    // ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹ÙˆØ§Øª
    let inviteStats = null;

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø²Ø±Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹ÙˆØ§Øª
    function setupInviteSystem() {
        const inviteBtn = document.getElementById('inviteBtn');
        const inviteModal = document.getElementById('inviteModal');
        const closeInviteModal = document.getElementById('closeInviteModal');
        const copyInviteCode = document.getElementById('copyInviteCode');
        const useInviteForm = document.getElementById('useInviteForm');
        const useInviteInput = document.getElementById('useInviteInput');
        const inviteMsg = document.getElementById('inviteMsg');

        inviteBtn.onclick = () => {
            inviteModal.style.display = 'flex';
            loadInviteStats();
        };

        closeInviteModal.onclick = () => {
            inviteModal.style.display = 'none';
            inviteMsg.textContent = '';
        };

        copyInviteCode.onclick = async () => {
            const inviteCode = document.getElementById('inviteCode').textContent;
            if (inviteCode && inviteCode !== '...Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„') {
                try {
                    await navigator.clipboard.writeText(inviteCode);
                    inviteMsg.textContent = 'ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ©!';
                    setTimeout(() => inviteMsg.textContent = '', 3000);
                } catch (err) {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = inviteCode;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    inviteMsg.textContent = 'ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ©!';
                    setTimeout(() => inviteMsg.textContent = '', 3000);
                }
            }
        };

        useInviteForm.onsubmit = async function(e) {
            e.preventDefault();
            const code = useInviteInput.value.trim().toUpperCase();
            if (!code) return;

            const token = localStorage.getItem('token');
            try {
                const res = await fetch(`${BACKEND_URL}/api/users/use-invite-code`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ inviteCode: code })
                });
                const data = await res.json();
                
                if (res.ok) {
                    inviteMsg.textContent = data.message;
                    useInviteInput.value = '';
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©
                    if (window.score !== undefined) {
                        window.score += data.reward;
                        if (window.updateDisplay) {
                            window.updateDisplay();
                        }
                    }
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                    loadInviteStats();
                } else {
                    inviteMsg.textContent = data.message;
                }
            } catch (e) {
                inviteMsg.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…';
            }
        };
    }

    async function loadInviteStats() {
        const token = localStorage.getItem('token');
        if (!token) return;

        try {
            const res = await fetch(`${BACKEND_URL}/api/users/invite-stats`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const data = await res.json();
            
            if (res.ok) {
                inviteStats = data;
                displayInviteStats(data);
            }
        } catch (e) {
            console.error('Error loading invite stats:', e);
        }
    }

    function displayInviteStats(data) {
        // Ø¹Ø±Ø¶ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ©
        document.getElementById('inviteCode').textContent = data.inviteCode;
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        document.getElementById('totalInvited').textContent = data.totalInvited;
        document.getElementById('totalRewards').textContent = data.inviteRewards.toLocaleString();
        
        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¯Ø¹ÙˆÙŠÙ†
        const invitedUsersDiv = document.getElementById('invitedUsers');
        if (data.invitedUsersDetails && data.invitedUsersDetails.length > 0) {
            invitedUsersDiv.innerHTML = data.invitedUsersDetails.map(user => `
                <div style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 8px;
                    background: white;
                    border-radius: 6px;
                    margin-bottom: 5px;
                    border: 1px solid #e5e7eb;
                ">
                    <div>
                        <div style="font-weight: bold;">${user.username}</div>
                        <div style="font-size: 12px; color: #666;">
                            Ø§Ù†Ø¶Ù…: ${new Date(user.createdAt).toLocaleDateString('ar-SA')}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: bold; color: #4f46e5;">${user.score.toLocaleString()}</div>
                        <div style="font-size: 12px; color: #666;">Ù†Ù‚Ø·Ø©</div>
                    </div>
                </div>
            `).join('');
        } else {
            invitedUsersDiv.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ù… ØªØ¯Ø¹ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯</p>';
        }
    }
    </script>
</body>
</html>
