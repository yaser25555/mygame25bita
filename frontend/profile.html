<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; connect-src 'self' https://mygame25bita-7eqw.onrender.com wss: ws:; style-src 'self' 'unsafe-inline'; img-src 'self' data:;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Voice Boom">
    <meta name="theme-color" content="#002A1B">
    <meta name="msapplication-TileColor" content="#002A1B">
    <meta name="msapplication-navbutton-color" content="#002A1B">
    <title>البروفايل - INFINITY Kingdom of luck</title>
    <link rel="stylesheet" href="profile-styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logo.png">
</head>
<body>
    <div class="container">
        <!-- شريط التنقل -->
        <nav class="navbar">
            <div class="nav-left">
                <button class="nav-btn" data-action="goBack">â† رجوع</button>
            </div>
            <div class="nav-center">
                <h1>الملف الشخصي</h1>
            </div>
            <div class="nav-right">
                <button class="nav-btn" data-action="editProfile">âœï¸</button>
            </div>
        </nav>

        <!-- مُعلَنات البروفايل الأساسية -->
        <div class="profile-header">
            <div class="profile-avatar">
                <img id="user-avatar" src="images/default-avatar.png" alt="الصورة الشخصية">
                <button class="edit-avatar-btn" data-action="editAvatar">ðŸ“·</button>
            </div>
            <div class="profile-info">
                <h2 id="display-name">اسم المستخدم</h2>
                <div class="user-id" id="user-id">ID: -</div>
                <div class="user-time-online" id="user-time-online">0 يوم 0 ساعة</div>
                <div class="user-level">المستوى: <span id="user-level">1</span></div>
            </div>
        </div>

        <!-- حالة الدرع -->
        <div class="shield-status inactive" id="shield-status">
            <div class="shield-icon">ðŸ›¡ï¸</div>
            <div class="shield-info">
                <div class="shield-duration" id="shield-duration">-</div>
            </div>
        </div>

        <!-- الجوائز اليومية -->
        <div class="daily-reward-container" id="daily-reward-status">
            <!-- محتوى الجوائز اليومية سيتم إضافته بواسطة JavaScript -->
        </div>

        <!-- حاوية المعلومات الشاملة -->
        <div class="info-container">
            <!-- الإنجازات -->
            <div class="achievements-section">
                <h3>ðŸ† الإنجازات</h3>
                <div class="achievements-grid" id="achievements-grid">
                    <div class="achievement-placeholder">لا توجد إنجازات بعد</div>
                </div>
            </div>

            <!-- الأصدقاء -->
            <div class="friends-section">
                <h3>ðŸ‘¥ الأصدقاء <button class="add-friend-btn" onclick="showAddFriendModal()">âž•</button></h3>
                <div class="friends-grid" id="friends-grid">
                    <div class="friends-placeholder">لا توجد أصدقاء بعد</div>
                </div>
            </div>
        </div>

        <!-- أزرار الإجراءات -->
        <div class="action-buttons">
            <button class="btn primary" data-action="playGame">ðŸŽ® اللعب الآن</button>
            <button class="btn secondary" data-action="privateChat">ðŸ’¬ المحادثة الخاصة</button>
        </div>
    </div>

    <!-- نافذة لتعديل الصورة الشخصية -->
    <div id="avatarModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAvatarModal()">&times;</span>
            <h3>تغيير الصورة الشخصية</h3>
            <form id="avatarForm" onsubmit="updateAvatar(event)">
                <div class="form-group">
                    <label for="avatarFile">اختر صورة:</label>
                    <input type="file" id="avatarFile" accept="image/*" onchange="previewAvatar(event)" required>
                </div>
                <div class="avatar-crop-container">
                    <div class="crop-area">
                        <img id="avatarPreview" src="" alt="معاينة" style="display: none;">
                        <div class="crop-overlay" id="cropOverlay" style="display: none;">
                            <div class="crop-frame" id="cropFrame"></div>
                        </div>
                    </div>
                    <div class="crop-controls" id="cropControls" style="display: none;">
                        <button type="button" onclick="adjustCrop('zoom-in')" class="btn secondary">🔍+ تكبير</button>
                        <button type="button" onclick="adjustCrop('zoom-out')" class="btn secondary">🔍- تصغير</button>
                        <button type="button" onclick="resetCrop()" class="btn secondary">ðŸ”„ إعادة تعيين</button>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn primary">ðŸ’¾ حفظ</button>
                    <button type="button" onclick="closeAvatarModal()" class="btn secondary">âŒ إلغاء</button>
                </div>
            </form>
        </div>
    </div>

    <!-- نافذة لتعديل البروفايل -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProfileModal()">&times;</span>
            <h3>تعديل البروفايل</h3>
            <form id="profileForm" onsubmit="updateProfile(event)">
                <div class="form-group">
                    <label for="displayName">الاسم المعروض:</label>
                    <input type="text" id="displayNameInput" required>
                </div>
                <div class="form-group">
                    <label for="genderSelect">الجنس:</label>
                    <select id="genderSelect">
                        <option value="prefer-not-to-say">أفضل عدم الإفصاح</option>
                        <option value="male">ذكر</option>
                        <option value="female">أنثى</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn primary">ðŸ’¾ حفظ</button>
                    <button type="button" onclick="closeProfileModal()" class="btn secondary">âŒ إلغاء</button>
                </div>
            </form>
        </div>
    </div>

    <!-- نافذة المحادثة الخاصة -->
    <div id="privateChatModal" class="modal">
        <div class="modal-content" style="max-width: 350px;">
            <span class="close" onclick="closePrivateChat()">&times;</span>
            <h3 id="privateChatTitle">محادثة خاصة</h3>
            <div id="privateChatMessages" class="private-chat-messages"></div>
            <form id="privateChatForm" onsubmit="sendPrivateMessage(event)">
                <input type="text" id="privateChatInput" placeholder="اكتب رسالة..." autocomplete="off" required style="width: 100%; margin-top: 10px; padding: 8px; border-radius: 8px; border: 1px solid #ccc;">
                <button type="submit" class="btn primary" style="width: 100%; margin-top: 8px;">إرسال</button>
            </form>
        </div>
    </div>

    <!-- حاوية المحادثة الخاصة -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-sidebar" id="chatSidebar">
            <div class="chat-sidebar-header">
                <span>المحادثات الخاصة</span>
            </div>
            <div class="chat-list" id="chatList">
                <!-- قائمة المحادثات الخاصة -->
            </div>
        </div>
        <div class="chat-main" id="chatMain">
            <div class="chat-header" id="chatHeader">
                <span id="chatWithName">اختر صديقاً لبدء المحادثة</span>
                <span class="chat-status" id="chatStatus"></span>
                <button class="sound-toggle-btn" id="soundToggleBtn" title="إيقاف/تشغيل الصوت">🔔</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <!-- الرسائل تظهر هنا -->
            </div>
            <form class="chat-input-form" id="chatInputForm" style="display: none;">
                <input type="text" id="chatInput" placeholder="اكتب رسالة..." autocomplete="off" required />
                <button type="submit" class="btn primary">إرسال</button>
            </form>
        </div>
    </div>

    <script>
        // تسجيل Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('✅ تم تسجيل Service Worker بنجاح:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('❗ فشل في تسجيل Service Worker:', error);
                    });
            });
        }
    </script>
    <script src="config.js"></script>
    <script src="socket.io.min.js"></script>
    <script src="profile.js"></script>
</body>
</html>
<title>البروفايل - INFINITY Kingdom of luck</title>